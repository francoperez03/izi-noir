# CLI Guide: create-izi-noir

> Scaffold new IZI-NOIR ZK projects in seconds

The `create-izi-noir` CLI helps you quickly set up a new project with circuits, build configuration, and testing scripts.

## Table of Contents

1. [Installation](#installation)
2. [Quick Start](#quick-start)
3. [CLI Options](#cli-options)
4. [Templates](#templates)
5. [Project Structure](#project-structure)
6. [Development Workflow](#development-workflow)
7. [Build Configuration](#build-configuration)
8. [Publishing Your Circuits](#publishing-your-circuits)
9. [Using in Frontend](#using-in-frontend)

---

## Installation

### Using npx (Recommended)

No installation required - run directly:

```bash
npx create-izi-noir my-project
```

### Global Installation

Install globally for repeated use:

```bash
npm install -g create-izi-noir

# Then run anywhere
create-izi-noir my-project
```

---

## Quick Start

### Interactive Mode

Run without arguments for guided setup:

```bash
npx create-izi-noir
```

You'll be prompted for:
- Project name
- Template selection
- Proving provider
- Whether to install dependencies
- Whether to initialize git

### Non-Interactive Mode

Use `--yes` to skip prompts and use defaults:

```bash
npx create-izi-noir my-project --yes
```

### After Scaffolding

```bash
cd my-project
npm run build    # Compile circuits
npm test         # Generate and verify proofs
```

---

## CLI Options

```
Usage: create-izi-noir [project-name] [options]

Options:
  -t, --template <template>   Template to use (default: "default")
  -p, --provider <provider>   Proving provider (default: "arkworks")
  -y, --yes                   Skip prompts and use defaults
  --skip-install              Skip npm install
  --skip-git                  Skip git initialization
  -V, --version               Output version number
  -h, --help                  Display help
```

### Examples

```bash
# Create with specific template
npx create-izi-noir my-project --template balance-proof

# Create with Barretenberg provider (faster, larger proofs)
npx create-izi-noir my-project --provider barretenberg

# Quick setup without prompts
npx create-izi-noir my-project -y

# Setup without installing dependencies
npx create-izi-noir my-project --skip-install

# CI/CD friendly (no prompts, no git, no install)
npx create-izi-noir my-project -y --skip-install --skip-git
```

---

## Templates

### default

Includes both balance proof and age verification circuits. Best for getting started and learning.

```
circuits/
├── balance-proof.ts   # Prove balance >= threshold
├── age-proof.ts       # Prove age >= minimum
└── index.ts           # Re-exports all circuits
```

**Balance Proof Circuit:**
```typescript
export function balanceProof(
  [threshold]: [number],   // public: minimum required
  [balance]: [number]      // private: actual balance
): void {
  assert(balance >= threshold);
}
```

**Age Proof Circuit:**
```typescript
export function ageProof(
  [currentYear, minAge]: [number, number],  // public
  [birthYear]: [number]                     // private
): void {
  const age = currentYear - birthYear;
  assert(age >= minAge);
}
```

### minimal

A blank canvas with a single empty circuit. Best for starting from scratch.

```
circuits/
├── my-circuit.ts      # Your custom circuit
└── index.ts
```

**Minimal Circuit:**
```typescript
export function myCircuit(
  [publicInput]: [number],
  [privateInput]: [number]
): void {
  assert(privateInput === publicInput);
}
```

### balance-proof

Just the balance proof circuit. Best for financial applications.

```
circuits/
├── balance-proof.ts
└── index.ts
```

---

## Project Structure

After scaffolding, your project looks like this:

```
my-project/
├── circuits/              # Your circuit source files
│   ├── balance-proof.ts   # Example circuits (varies by template)
│   ├── age-proof.ts
│   └── index.ts           # Re-exports all circuits
├── generated/             # Compiled circuit artifacts
│   └── .gitkeep           # Generated by npm run build
├── scripts/
│   └── test-proof.ts      # Test script for your circuits
├── izi-noir.config.ts     # Build configuration
├── package.json
├── tsconfig.json
└── README.md
```

### Key Directories

| Directory | Purpose |
|-----------|---------|
| `circuits/` | Write your circuit functions here |
| `generated/` | Compiled circuits (auto-generated) |
| `scripts/` | Testing and utility scripts |

---

## Development Workflow

### 1. Write Circuits

Create TypeScript files in `circuits/`:

```typescript
// circuits/my-secret-proof.ts

/**
 * Prove knowledge of a secret without revealing it.
 */
export function secretProof(
  [commitment]: [number],  // public: hash commitment
  [secret]: [number]       // private: the secret value
): void {
  assert(secret * secret === commitment);
}
```

Export from `circuits/index.ts`:

```typescript
export { balanceProof } from './balance-proof.js';
export { secretProof } from './my-secret-proof.js';
```

### 2. Build Circuits

```bash
npm run build
```

This compiles all circuits in `circuits/` and outputs artifacts to `generated/`.

### 3. Watch Mode

For development, use watch mode to auto-recompile on changes:

```bash
npm run dev
```

### 4. Test Proofs

Run the test script to generate and verify proofs:

```bash
npm test
```

Edit `scripts/test-proof.ts` to add tests for your circuits:

```typescript
import { IziNoir, Provider } from '@izi-noir/sdk';
import { secretProof } from '../circuits/index.js';

async function main() {
  const izi = await IziNoir.init({
    provider: Provider.Arkworks,
  });

  console.log('Testing secretProof...');
  const result = await izi.createProof(
    secretProof,
    [100],    // public: commitment (10² = 100)
    [10]      // private: secret
  );
  console.log('  Proof verified:', result.verified);
}

main().catch(console.error);
```

---

## Build Configuration

The `izi-noir.config.ts` file controls how circuits are built:

```typescript
import { defineConfig } from '@izi-noir/sdk';

export default defineConfig({
  // Source directory for circuit files
  circuitsDir: './circuits',

  // Output directory for compiled artifacts
  outDir: './generated',

  // Proving provider: 'arkworks' or 'barretenberg'
  provider: 'arkworks',

  // Watch mode settings
  watch: {
    debounce: 100,  // ms to wait before recompiling
  },

  // Advanced options
  advanced: {
    debug: false,     // Enable verbose logging
    parallel: true,   // Compile circuits in parallel
  },
});
```

### Configuration Options

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `circuitsDir` | `string` | `'./circuits'` | Source directory |
| `outDir` | `string` | `'./generated'` | Output directory |
| `provider` | `'arkworks' \| 'barretenberg'` | `'arkworks'` | Proving backend |
| `watch.debounce` | `number` | `100` | Watch mode debounce (ms) |
| `advanced.debug` | `boolean` | `false` | Enable debug output |
| `advanced.parallel` | `boolean` | `true` | Parallel compilation |

---

## Publishing Your Circuits

### As an NPM Package

1. Update `package.json` with your package details:

```json
{
  "name": "@myorg/zk-circuits",
  "version": "1.0.0",
  "exports": {
    ".": "./circuits/index.js",
    "./generated": "./generated/index.js"
  }
}
```

2. Build and publish:

```bash
npm run build
npm publish
```

### Dual Export Pattern

Export both source circuits and compiled artifacts:

```typescript
// Consumers can import source circuits
import { balanceProof } from '@myorg/zk-circuits';

// Or pre-compiled artifacts for faster proving
import { balanceProofCompiled } from '@myorg/zk-circuits/generated';
```

---

## Using in Frontend

### Vite Setup

1. Install dependencies:

```bash
npm install @izi-noir/sdk
```

2. Configure Vite for WASM:

```typescript
// vite.config.ts
import { defineConfig } from 'vite';

export default defineConfig({
  optimizeDeps: {
    exclude: ['@noir-lang/noirc_abi', '@noir-lang/acvm_js'],
  },
});
```

3. Initialize WASM before using:

```typescript
// main.ts
import initNoirC from '@noir-lang/noirc_abi';
import initACVM from '@noir-lang/acvm_js';
import acvm from '@noir-lang/acvm_js/web/acvm_js_bg.wasm?url';
import noirc from '@noir-lang/noirc_abi/web/noirc_abi_wasm_bg.wasm?url';
import { markWasmInitialized, IziNoir, Provider } from '@izi-noir/sdk';

// Initialize WASM modules
await Promise.all([initACVM(fetch(acvm)), initNoirC(fetch(noirc))]);
markWasmInitialized();

// Now you can use IziNoir
const izi = await IziNoir.init({ provider: Provider.Arkworks });
```

### React Component Example

```tsx
import { useState } from 'react';
import { IziNoir, Provider, Chain } from '@izi-noir/sdk';
import { balanceProof } from './circuits';

function ProofGenerator() {
  const [isProving, setIsProving] = useState(false);
  const [result, setResult] = useState<string | null>(null);

  async function generateProof() {
    setIsProving(true);
    try {
      const izi = await IziNoir.init({
        provider: Provider.Arkworks,
        chain: Chain.Solana,  // Format for Solana verification
      });

      const proof = await izi.createProof(
        balanceProof,
        [100],     // threshold (public)
        [1500]     // balance (private)
      );

      setResult(proof.verified ? 'Proof valid!' : 'Proof invalid');
    } finally {
      setIsProving(false);
    }
  }

  return (
    <div>
      <button onClick={generateProof} disabled={isProving}>
        {isProving ? 'Generating...' : 'Generate Proof'}
      </button>
      {result && <p>{result}</p>}
    </div>
  );
}
```

---

## Next Steps

- [User Guide](./USER_GUIDE.md) - Complete SDK documentation
- [Solana Integration](./SOLANA_INTEGRATION.md) - On-chain verification
- [Architecture](./ARCHITECTURE.md) - Technical deep-dive
